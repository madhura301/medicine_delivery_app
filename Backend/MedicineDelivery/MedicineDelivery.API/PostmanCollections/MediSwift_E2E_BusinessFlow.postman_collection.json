{
	"info": {
		"_postman_id": "mediswift-e2e-business-flow",
		"name": "MediSwift - End-to-End Business Flow",
		"description": "Complete end-to-end test of the Medicine Delivery Application business flow.\n\nRun this collection using Postman's Collection Runner to execute all requests sequentially with a single click.\n\n**IMPORTANT - Working Directory Setup:**\nFor bill upload steps to work, set the Postman working directory to the folder containing `test_bill.pdf`:\n  Settings > General > Working Directory > set to the `PostmanCollections` folder.\n\nCovers:\n- System bootstrap (roles, permissions, users)\n- Admin login, service region & customer support setup\n- Customer registration, login, address management\n- Medical store registration and login\n- Order creation, acceptance, bill upload, delivery, payment, OTP completion (Happy Path)\n- Order rejection and customer support reassignment flow (Reject Path)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{ "key": "baseUrl", "value": "http://localhost:5000", "type": "string" },
		{ "key": "adminToken", "value": "", "type": "string" },
		{ "key": "customerToken", "value": "", "type": "string" },
		{ "key": "chemistToken", "value": "", "type": "string" },
		{ "key": "csToken", "value": "", "type": "string" },
		{ "key": "csPassword", "value": "", "type": "string" },
		{ "key": "customerId", "value": "", "type": "string" },
		{ "key": "customerAddressId", "value": "", "type": "string" },
		{ "key": "medicalStoreId", "value": "", "type": "string" },
		{ "key": "deliveryId", "value": "", "type": "string" },
		{ "key": "csRegionId", "value": "", "type": "string" },
		{ "key": "customerSupportId", "value": "", "type": "string" },
		{ "key": "orderId", "value": "", "type": "string" },
		{ "key": "orderId2", "value": "", "type": "string" },
		{ "key": "orderOtp", "value": "", "type": "string" },
		{ "key": "orderOtp2", "value": "", "type": "string" }
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"console.log('\\n========== ' + pm.info.requestName + ' ==========');"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global diagnostic logging for every response",
					"console.log('[' + pm.info.requestName + '] Status: ' + pm.response.code + ' ' + pm.response.status);",
					"if (pm.response.code >= 400) {",
					"    console.error('[' + pm.info.requestName + '] ERROR BODY: ' + pm.response.text());",
					"}"
				]
			}
		}
	],
	"item": [
		{
			"name": "1 - System Bootstrap (Setup)",
			"description": "One-time setup: creates predefined roles, permissions, role-permission mappings, and admin seed user.",
			"item": [
				{
					"name": "01. Create Predefined Roles",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/setup/roles/predefined",
							"host": ["{{baseUrl}}"],
							"path": ["api", "setup", "roles", "predefined"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Predefined roles created or already exist', function () {",
									"    pm.expect([200, 409]).to.include(pm.response.code);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "02. Create Predefined Permissions",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/setup/permissions/predefined",
							"host": ["{{baseUrl}}"],
							"path": ["api", "setup", "permissions", "predefined"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Predefined permissions created or already exist', function () {",
									"    pm.expect([200, 409]).to.include(pm.response.code);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "03. Map Role Permissions",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/setup/role-permissions/predefined",
							"host": ["{{baseUrl}}"],
							"path": ["api", "setup", "role-permissions", "predefined"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Role-permission mappings created or already exist', function () {",
									"    pm.expect([200, 409]).to.include(pm.response.code);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "04. Create Admin User",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/setup/users/admin",
							"host": ["{{baseUrl}}"],
							"path": ["api", "setup", "users", "admin"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Admin user created or already exists', function () {",
									"    pm.expect([200, 409]).to.include(pm.response.code);",
									"});"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "2 - Admin Login & Region Setup",
			"description": "Admin logs in, creates a CustomerSupport-type service region with pin codes, registers customer support staff (which creates the CS Identity user), and assigns the region.",
			"item": [
				{
					"name": "05. Admin Login",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"mobileNumber\": \"9999999999\",\n    \"password\": \"Admin@123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Auth", "login"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Admin login successful', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    pm.expect(json.success).to.eql(true);",
									"    pm.expect(json.token).to.be.a('string').and.not.empty;",
									"    pm.collectionVariables.set('adminToken', json.token);",
									"    console.log('Admin token captured.');",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "06. Create CS Region (CustomerSupport type)",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{adminToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Pune Central Support Region\",\n    \"city\": \"Pune\",\n    \"regionName\": \"Pune Central\",\n    \"regionType\": 0,\n    \"pinCodes\": [\"411001\", \"411002\", \"411003\"]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/ServiceRegions",
							"host": ["{{baseUrl}}"],
							"path": ["api", "ServiceRegions"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('CS Region created', function () {",
									"    pm.expect([200, 201]).to.include(pm.response.code);",
									"    var json = pm.response.json();",
									"    var regionId = json.id;",
									"    pm.expect(regionId).to.not.be.undefined;",
									"    pm.collectionVariables.set('csRegionId', regionId.toString());",
									"    console.log('csRegionId =', regionId);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "07. Register Customer Support Staff",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{adminToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"customerSupportFirstName\": \"Jane\",\n    \"customerSupportLastName\": \"Support\",\n    \"customerSupportMiddleName\": \"M\",\n    \"address\": \"123 Support Street\",\n    \"city\": \"Pune\",\n    \"state\": \"Maharashtra\",\n    \"mobileNumber\": \"7777777777\",\n    \"emailId\": \"support@medicine.com\",\n    \"alternativeMobileNumber\": \"7777777778\",\n    \"employeeId\": \"CS-001\",\n    \"serviceRegionId\": {{csRegionId}}\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/CustomerSupports/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "CustomerSupports", "register"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Customer Support staff registered', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    // Response is CustomerSupportResponseDto (flat, not wrapped)",
									"    var csId = json.customerSupportId;",
									"    pm.expect(csId).to.not.be.undefined;",
									"    pm.collectionVariables.set('customerSupportId', csId.toString());",
									"    // BUG FIX #2: Capture the randomly generated password for CS login later",
									"    var csPass = json.password;",
									"    pm.expect(csPass).to.be.a('string').and.not.empty;",
									"    pm.collectionVariables.set('csPassword', csPass);",
									"    console.log('customerSupportId =', csId);",
									"    console.log('csPassword captured (length:', csPass.length, ')');",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "08. Assign CS Region to Support Staff",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{adminToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"serviceRegionId\": {{csRegionId}},\n    \"customerSupportId\": \"{{customerSupportId}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/ServiceRegions/assign",
							"host": ["{{baseUrl}}"],
							"path": ["api", "ServiceRegions", "assign"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Region assigned to CS staff', function () {",
									"    pm.response.to.have.status(200);",
									"    console.log('Region assignment response:', pm.response.text());",
									"});"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "3 - Customer Registration & Profile",
			"description": "Customer self-registers, logs in, views profile, and adds a delivery address.",
			"item": [
				{
					"name": "09. Register Customer",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"customerFirstName\": \"Ravi\",\n    \"customerLastName\": \"Sharma\",\n    \"customerMiddleName\": \"K\",\n    \"mobileNumber\": \"1234567890\",\n    \"password\": \"Test@1234\",\n    \"alternativeMobileNumber\": \"1234567891\",\n    \"emailId\": \"ravi.sharma@test.com\",\n    \"dateOfBirth\": \"1995-06-15T00:00:00Z\",\n    \"gender\": \"Male\",\n    \"addresses\": []\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Customers/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Customers", "register"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Customer registered', function () {",
									"    pm.expect([200, 201]).to.include(pm.response.code);",
									"    var json = pm.response.json();",
									"    // BUG FIX #3: Response is wrapped: { success, customer: { customerId: ... }, errors }",
									"    pm.expect(json.success).to.eql(true);",
									"    var custId = json.customer.customerId;",
									"    pm.expect(custId).to.not.be.undefined;",
									"    pm.collectionVariables.set('customerId', custId.toString());",
									"    console.log('customerId =', custId);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "10. Customer Login",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"mobileNumber\": \"1234567890\",\n    \"password\": \"Test@1234\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Auth", "login"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Customer login successful', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    pm.expect(json.success).to.eql(true);",
									"    pm.expect(json.token).to.be.a('string').and.not.empty;",
									"    pm.collectionVariables.set('customerToken', json.token);",
									"    // BUG FIX #4: entityId is always null in API AuthService - don't try to read it",
									"    console.log('Customer token captured. customerId already set to:', pm.collectionVariables.get('customerId'));",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "11. View My Profile",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Customers/my-profile",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Customers", "my-profile"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Customer profile retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Profile:', json.customerFirstName, json.customerLastName, '| CustomerId:', json.customerId);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "12. Add Customer Address",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"customerId\": \"{{customerId}}\",\n    \"address\": \"Flat 201, Green Tower, MG Road\",\n    \"addressLine1\": \"Flat 201, Green Tower\",\n    \"addressLine2\": \"MG Road\",\n    \"addressLine3\": \"Near City Mall\",\n    \"city\": \"Pune\",\n    \"state\": \"Maharashtra\",\n    \"postalCode\": \"411001\",\n    \"latitude\": 18.52043100,\n    \"longitude\": 73.85674400,\n    \"isDefault\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/CustomerAddresses",
							"host": ["{{baseUrl}}"],
							"path": ["api", "CustomerAddresses"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Customer address created', function () {",
									"    pm.expect([200, 201]).to.include(pm.response.code);",
									"    var json = pm.response.json();",
									"    var addrId = json.id;",
									"    pm.expect(addrId).to.not.be.undefined;",
									"    pm.collectionVariables.set('customerAddressId', addrId.toString());",
									"    console.log('customerAddressId =', addrId);",
									"});"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "4 - Medical Store Registration & Login",
			"description": "Medical store self-registers, logs in, and views profile.",
			"item": [
				{
					"name": "13. Register Medical Store",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"medicalName\": \"HealthPlus Pharmacy\",\n    \"ownerFirstName\": \"Amit\",\n    \"ownerLastName\": \"Patel\",\n    \"ownerMiddleName\": \"R\",\n    \"password\": \"Chemist@123\",\n    \"addressLine1\": \"Shop 5, Market Yard\",\n    \"addressLine2\": \"Laxmi Road\",\n    \"city\": \"Pune\",\n    \"state\": \"Maharashtra\",\n    \"postalCode\": \"411001\",\n    \"latitude\": 18.51570000,\n    \"longitude\": 73.85620000,\n    \"mobileNumber\": \"5555555555\",\n    \"emailId\": \"chemist@medicine.com\",\n    \"alternativeMobileNumber\": \"5555555556\",\n    \"registrationStatus\": true,\n    \"gstin\": \"27AADCB2230M1Z3\",\n    \"pan\": \"AADCB2230M\",\n    \"fssaiNo\": \"10020031000001\",\n    \"dlNo\": \"MH-PUN-123456\",\n    \"pharmacistFirstName\": \"Suresh\",\n    \"pharmacistLastName\": \"Iyer\",\n    \"pharmacistRegistrationNumber\": \"PH-MH-2020-001\",\n    \"pharmacistMobileNumber\": \"5555555557\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/MedicalStores/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "MedicalStores", "register"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Medical Store registered', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    // BUG FIX #5: Response is wrapped: { success, medicalStore: { medicalStoreId: ... }, errors }",
									"    pm.expect(json.success).to.eql(true);",
									"    var storeId = json.medicalStore.medicalStoreId;",
									"    pm.expect(storeId).to.not.be.undefined;",
									"    pm.collectionVariables.set('medicalStoreId', storeId.toString());",
									"    console.log('medicalStoreId =', storeId);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "14. Medical Store Login",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"mobileNumber\": \"5555555555\",\n    \"password\": \"Chemist@123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Auth", "login"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Chemist login successful', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    pm.expect(json.success).to.eql(true);",
									"    pm.expect(json.token).to.be.a('string').and.not.empty;",
									"    pm.collectionVariables.set('chemistToken', json.token);",
									"    // BUG FIX #4: entityId is always null in API AuthService - don't use it",
									"    console.log('Chemist token captured. medicalStoreId already set to:', pm.collectionVariables.get('medicalStoreId'));",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "15. View Medical Store Profile",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/MedicalStores/{{medicalStoreId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "MedicalStores", "{{medicalStoreId}}"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Medical store profile retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Medical Store:', json.medicalName, '| City:', json.city);",
									"});"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "5 - Delivery Boy Setup",
			"description": "Admin creates a delivery boy linked to the medical store.",
			"item": [
				{
					"name": "16. Create Delivery Boy",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{adminToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"firstName\": \"Ramesh\",\n    \"middleName\": \"D\",\n    \"lastName\": \"Jadhav\",\n    \"drivingLicenceNumber\": \"MH12-2020-0056789\",\n    \"mobileNumber\": \"4444444444\",\n    \"medicalStoreId\": \"{{medicalStoreId}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Deliveries",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Deliveries"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Delivery boy created', function () {",
									"    pm.expect([200, 201]).to.include(pm.response.code);",
									"    var json = pm.response.json();",
									"    var delId = json.id;",
									"    pm.expect(delId).to.not.be.undefined;",
									"    pm.collectionVariables.set('deliveryId', delId.toString());",
									"    console.log('deliveryId =', delId);",
									"});"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "6 - Order Accept Flow (Happy Path)",
			"description": "Customer creates an order -> Medical store accepts -> Uploads bill -> Assigns delivery -> Payment -> OTP -> Complete.",
			"item": [
				{
					"name": "17. Create Order (Text type)",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{ "key": "CustomerId", "value": "{{customerId}}", "type": "text" },
								{ "key": "CustomerAddressId", "value": "{{customerAddressId}}", "type": "text" },
								{ "key": "OrderType", "value": "1", "description": "OTC=1", "type": "text" },
								{ "key": "OrderInputType", "value": "2", "description": "Text=2", "type": "text" },
								{ "key": "OrderInputText", "value": "Paracetamol 500mg x 10, Crocin Advance x 5, Dolo 650mg x 10", "type": "text" }
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Orders",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Order created', function () {",
									"    pm.expect([200, 201]).to.include(pm.response.code);",
									"    var json = pm.response.json();",
									"    var oid = json.orderId;",
									"    pm.expect(oid).to.not.be.undefined;",
									"    pm.collectionVariables.set('orderId', oid.toString());",
									"    console.log('orderId =', oid, '| orderNumber:', json.orderNumber, '| orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "18. View Order Details",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId}}"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Order details retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('orderStatus:', json.orderStatus, '| medicalStoreId:', json.medicalStoreId);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "19. Medical Store Views Active Orders",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Orders/medicalstore/{{medicalStoreId}}/active",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "medicalstore", "{{medicalStoreId}}", "active"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Active orders retrieved for medical store', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Active orders count:', Array.isArray(json) ? json.length : 'N/A');",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "20. Medical Store Accepts Order",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId}}/accept",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId}}", "accept"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Order accepted by medical store', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Order accepted. orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "21. Upload Bill",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{ "key": "OrderId", "value": "{{orderId}}", "type": "text" },
								{ "key": "OrderAmount", "value": "450.00", "type": "text" },
								{ "key": "DeliveryId", "value": "{{deliveryId}}", "type": "text" },
								{ "key": "BillFile", "type": "file", "src": "test_bill.pdf", "description": "Dummy bill PDF. Ensure Postman working directory points to the PostmanCollections folder." }
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId}}/upload-bill",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId}}", "upload-bill"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Bill uploaded successfully', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Bill uploaded. orderStatus:', json.orderStatus, '| totalAmount:', json.totalAmount);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "22. Assign to Delivery Boy",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"orderId\": {{orderId}},\n    \"deliveryId\": {{deliveryId}}\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Orders/assign-to-delivery",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "assign-to-delivery"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Order assigned to delivery boy', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Assigned to delivery. orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "23. Record Payment",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"orderId\": {{orderId}},\n    \"paymentMode\": \"UPI\",\n    \"transactionId\": \"TXN-{{$timestamp}}-001\",\n    \"amount\": 450.00,\n    \"paymentStatus\": 1\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Payments",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Payments"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Payment recorded', function () {",
									"    pm.expect([200, 201]).to.include(pm.response.code);",
									"    var json = pm.response.json();",
									"    console.log('Payment recorded. paymentId:', json.paymentId, '| amount:', json.amount);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "24. Get Order (Read OTP)",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId}}"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('OTP extracted from order', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    var otp = json.otp;",
									"    if (otp) {",
									"        pm.collectionVariables.set('orderOtp', otp.toString());",
									"        console.log('orderOtp =', otp, '| orderStatus:', json.orderStatus, '| orderPaymentStatus:', json.orderPaymentStatus);",
									"    } else {",
									"        console.warn('OTP not yet available. orderStatus:', json.orderStatus, '| orderPaymentStatus:', json.orderPaymentStatus);",
									"        pm.collectionVariables.set('orderOtp', '0000');",
									"    }",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "25. Complete Order (Delivery Handover with OTP)",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"otp\": \"{{orderOtp}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId}}/complete",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId}}", "complete"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Order completed with OTP', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Order completed. orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "26. Verify Order Completed",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId}}"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Order status is Completed (7)', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    pm.expect(json.orderStatus).to.eql(7);",
									"    console.log('HAPPY PATH COMPLETE! orderId:', json.orderId, '| orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "7 - Order Reject & Customer Support Flow",
			"description": "Customer creates a second order -> Medical store rejects -> Customer Support reassigns -> Medical store accepts -> Full delivery cycle.",
			"item": [
				{
					"name": "27. Create Second Order",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{ "key": "CustomerId", "value": "{{customerId}}", "type": "text" },
								{ "key": "CustomerAddressId", "value": "{{customerAddressId}}", "type": "text" },
								{ "key": "OrderType", "value": "2", "description": "PrescriptionDrugs=2", "type": "text" },
								{ "key": "OrderInputType", "value": "2", "description": "Text=2", "type": "text" },
								{ "key": "OrderInputText", "value": "Amoxicillin 500mg x 15, Azithromycin 250mg x 6, Cetirizine 10mg x 10", "type": "text" }
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Orders",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Second order created', function () {",
									"    pm.expect([200, 201]).to.include(pm.response.code);",
									"    var json = pm.response.json();",
									"    var oid = json.orderId;",
									"    pm.expect(oid).to.not.be.undefined;",
									"    pm.collectionVariables.set('orderId2', oid.toString());",
									"    console.log('orderId2 =', oid, '| orderNumber:', json.orderNumber, '| orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "28. Medical Store Rejects Order",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"rejectNote\": \"Out of stock for Amoxicillin and Azithromycin. Cannot fulfil this prescription order.\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId2}}/reject",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId2}}", "reject"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Order rejected by medical store', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Order rejected. orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "29. Customer Support Login",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"mobileNumber\": \"7777777777\",\n    \"password\": \"{{csPassword}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Auth", "login"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Customer Support login successful', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    pm.expect(json.success).to.eql(true);",
									"    pm.expect(json.token).to.be.a('string').and.not.empty;",
									"    pm.collectionVariables.set('csToken', json.token);",
									"    console.log('CS token captured.');",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "30. CS Views Assigned Orders",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{csToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Orders/customersupport/{{customerSupportId}}/assignedtocustomersupport",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "customersupport", "{{customerSupportId}}", "assignedtocustomersupport"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('CS assigned orders retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('CS assigned orders count:', Array.isArray(json) ? json.length : 'N/A');",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "31. CS Gets Medical Stores by Order City",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{csToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId2}}/medical-stores-by-city",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId2}}", "medical-stores-by-city"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Medical stores by city retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Available medical stores:', JSON.stringify(json));",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "32. CS Reassigns Order to Medical Store",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{csToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"orderId\": {{orderId2}},\n    \"medicalStoreId\": \"{{medicalStoreId}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Orders/assign",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "assign"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Order reassigned to medical store by CS', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Reassigned. orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "33. Medical Store Accepts Reassigned Order",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId2}}/accept",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId2}}", "accept"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Reassigned order accepted', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Reassigned order accepted. orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "34. Upload Bill for Reassigned Order",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{ "key": "OrderId", "value": "{{orderId2}}", "type": "text" },
								{ "key": "OrderAmount", "value": "875.50", "type": "text" },
								{ "key": "DeliveryId", "value": "{{deliveryId}}", "type": "text" },
								{ "key": "BillFile", "type": "file", "src": "test_bill.pdf", "description": "Dummy bill PDF. Ensure Postman working directory points to the PostmanCollections folder." }
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId2}}/upload-bill",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId2}}", "upload-bill"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Bill uploaded for reassigned order', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Bill uploaded (order 2). orderStatus:', json.orderStatus, '| totalAmount:', json.totalAmount);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "35. Assign Delivery for Reassigned Order",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"orderId\": {{orderId2}},\n    \"deliveryId\": {{deliveryId}}\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Orders/assign-to-delivery",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "assign-to-delivery"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Reassigned order assigned to delivery', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Delivery assigned (order 2). orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "36. Record Payment for Reassigned Order",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"orderId\": {{orderId2}},\n    \"paymentMode\": \"Card\",\n    \"transactionId\": \"TXN-{{$timestamp}}-002\",\n    \"amount\": 875.50,\n    \"paymentStatus\": 1\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Payments",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Payments"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Payment recorded for reassigned order', function () {",
									"    pm.expect([200, 201]).to.include(pm.response.code);",
									"    var json = pm.response.json();",
									"    console.log('Payment recorded (order 2). paymentId:', json.paymentId, '| amount:', json.amount);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "37. Get OTP for Reassigned Order",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId2}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId2}}"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('OTP extracted for reassigned order', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    var otp = json.otp;",
									"    if (otp) {",
									"        pm.collectionVariables.set('orderOtp2', otp.toString());",
									"        console.log('orderOtp2 =', otp, '| orderStatus:', json.orderStatus, '| orderPaymentStatus:', json.orderPaymentStatus);",
									"    } else {",
									"        console.warn('OTP not yet available for order 2. orderStatus:', json.orderStatus, '| orderPaymentStatus:', json.orderPaymentStatus);",
									"        pm.collectionVariables.set('orderOtp2', '0000');",
									"    }",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "38. Complete Reassigned Order",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{chemistToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"otp\": \"{{orderOtp2}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId2}}/complete",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId2}}", "complete"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Reassigned order completed with OTP', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    console.log('Order 2 completed. orderStatus:', json.orderStatus);",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "39. Verify Reassigned Order Completed",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{customerToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/api/Orders/{{orderId2}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "Orders", "{{orderId2}}"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Reassigned order status is Completed (7)', function () {",
									"    pm.response.to.have.status(200);",
									"    var json = pm.response.json();",
									"    pm.expect(json.orderStatus).to.eql(7);",
									"    console.log('REJECT-REASSIGN FLOW COMPLETE! orderId:', json.orderId, '| orderStatus:', json.orderStatus);",
									"});",
									"",
									"console.log('============================================');",
									"console.log('  MediSwift E2E Business Flow - ALL DONE!  ');",
									"console.log('============================================');"
								]
							}
						}
					]
				}
			]
		}
	]
}